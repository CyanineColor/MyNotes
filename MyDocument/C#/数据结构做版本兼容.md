```c#

using System;
using System.Text.Json;
using System.Text.Json.Serialization;

// 基础版本V1的数据结构
public class DeviceDataV1
{
    [JsonPropertyName("version")]
    public string Version { get; set; } = "1.0";
    
    [JsonPropertyName("deviceId")]
    public string DeviceId { get; set; }
    
    [JsonPropertyName("temperature")]
    public double Temperature { get; set; }
}

// 扩展版本V2（新增字段，保留旧字段）
public class DeviceDataV2 : DeviceDataV1
{
    [JsonPropertyName("version")]
    public new string Version { get; set; } = "2.0";
    
    [JsonPropertyName("humidity")]
    public double? Humidity { get; set; }  // 可空类型表示可选字段
}

public class JsonVersioningDemo
{
    private static readonly JsonSerializerOptions options = new()
    {
        PropertyNameCaseInsensitive = true,
        WriteIndented = true
    };

    public static void Main()
    {
        // 模拟旧版本数据
        var v1Data = new DeviceDataV1 
        { 
            DeviceId = "SN-001", 
            Temperature = 25.5 
        };
        
        string jsonV1 = JsonSerializer.Serialize(v1Data, options);
        Console.WriteLine("原始V1数据:\n" + jsonV1);

        // 模拟升级到V2（保留旧字段）
        var v2Data = new DeviceDataV2
        {
            DeviceId = v1Data.DeviceId,
            Temperature = v1Data.Temperature,
            Humidity = 60.2
        };
        
        string jsonV2 = JsonSerializer.Serialize(v2Data, options);
        Console.WriteLine("\n扩展V2数据:\n" + jsonV2);

        // 反序列化时根据version字段自动处理
        Console.WriteLine("\n反序列化演示:");
        ProcessJsonData(jsonV1);
        ProcessJsonData(jsonV2);
    }

    private static void ProcessJsonData(string json)
    {
        try
        {
            // 先读取version字段判断版本
            using JsonDocument doc = JsonDocument.Parse(json);
            string version = doc.RootElement.GetProperty("version").GetString();

            object data = version switch
            {
                "1.0" => JsonSerializer.Deserialize<DeviceDataV1>(json, options),
                "2.0" => JsonSerializer.Deserialize<DeviceDataV2>(json, options),
                _ => throw new NotSupportedException($"版本{version}不支持")
            };

            Console.WriteLine($"\n处理{version}版本数据:");
            Console.WriteLine(JsonSerializer.Serialize(data, options));
        }
        catch (Exception ex)
        {
            Console.WriteLine($"处理失败: {ex.Message}");
        }
    }
}

```