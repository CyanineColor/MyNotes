1.数据文件放到Avalonia项目下的Assets文件中


![[Pasted image 20250326161758.png]]
2属性设置为 
复制到输出目录 较新则复制
生成操作选择AvaloniaResource
![[Pasted image 20250326161842.png]]

2应用
```C#
public static class DatabaseHelper
{
    // 检查当前是否为移动端（Android/iOS）
    public static bool IsMobile =>
        OperatingSystem.IsAndroid() || OperatingSystem.IsIOS();

   private static string _dataBaseName="HeatData.db3";
    // 获取平台相关的目标数据库路径
    public static string GetDatabasePath()
    {
        if (IsMobile)
        {
            // 移动端：写入应用私有目录（Android: /data/user/0/[包名]/files）
            return Path.Combine(
                Environment.GetFolderPath(Environment.SpecialFolder.LocalApplicationData),
                _dataBaseName
            );
        }
        else
        {
            // 桌面端：写入用户应用数据目录（Windows: %AppData%, Linux: ~/.config）
            //return Path.Combine(
            //    Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData),
            //    "Heat",  // 替换为你的应用名称
            //    _dataBaseName
            //);
            //window无需复制
            return $"{AppDomain.CurrentDomain.BaseDirectory}/{_dataBaseName}";


        }
    }
    // 初始化数据库（应用启动时调用）
    public static async Task InitializeDatabaseAsync()
    {
        var targetPath = GetDatabasePath();
        var targetDir = Path.GetDirectoryName(targetPath);

        // 确保目录存在
        if (!Directory.Exists(targetDir))
        {
            Directory.CreateDirectory(targetDir);
        }

        // 仅当目标文件不存在时复制
        if (!File.Exists(targetPath))
        {
            await CopyEmbeddedDatabaseAsync(targetPath);
        }
        DbContext.Connection = "datasource=" + targetPath;

    }

    // 从嵌入资源复制数据库文件
    private static async Task CopyEmbeddedDatabaseAsync(string targetPath)
    {
        try
        {
            // 统一资源访问路径
            var assemblyName = Assembly.GetExecutingAssembly().GetName().Name;
            var resourceUri = new Uri($"avares://{assemblyName}/Assets/{_dataBaseName}");

            using var sourceStream = AssetLoader.Open(resourceUri);
            using var targetStream = File.Create(targetPath);
            await sourceStream.CopyToAsync(targetStream);


        }
        catch (Exception ex)
        {
            // 处理异常（如资源未找到、写入权限不足）
            throw new InvalidOperationException("Failed to initialize database", ex);
        }
    }
}
```